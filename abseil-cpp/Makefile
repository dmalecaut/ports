PROJECT=abseil-cpp
PROJCMAKEDIR=abseil-cpp
BUILDDIR=build
INSTALLDIR=/usr/local/opt/$(PROJECT)
BUILDTYPE=Release
CMGENERATOR=Ninja

CC=clang
CXX=clang++
CXXFLAGS=-stdlib=libc++
LDFLAGS=-lc++ -lc++abi

INSTALLSTEP=$(PROJECT)_install
BUILDSTEP=$(PROJECT)_build
CONFIGSTEP=$(PROJECT)_config
DEINSTALLSTEP=$(PROJECT)_deinstall
CLEANSTEP=$(PROJECT)_clean

all:

install: $(INSTALLSTEP)

build: $(BUILDSTEP)

config: $(CONFIGSTEP)

deinstall: $(DEINSTALLSTEP)

clean: $(CLEANSTEP)

$(INSTALLSTEP): build
	cmake --install $(BUILDDIR)

$(BUILDSTEP): config
	cmake --build $(BUILDDIR)

$(CONFIGSTEP):
	cmake -Wno-dev -G$(CMGENERATOR) -B$(BUILDDIR) -S$(PROJCMAKEDIR) \
		-DCMAKE_INSTALL_PREFIX=$(INSTALLDIR) \
		-DCMAKE_BUILD_TYPE=$(BUILDTYPE) \
		-DCMAKE_C_COMPILER=$(CC) \
		-DCMAKE_CXX_COMPILER=$(CXX) \
		-DCMAKE_CXX_FLAGS="$(CXXFLAGS)" \
		-DCMAKE_STATIC_LINKER_FLAGS="$(LDFLAGS)" \
		-DCMAKE_SHARED_LINKER_FLAGS="$(LDFLAGS)" \
		-DCMAKE_EXE_LINKER_FLAGS="$(LDFLAGS)" \
		-DBUILD_SHARED_LIBS=TRUE \
		-DABSL_ENABLE_INSTALL=ON \
		-DABSL_USE_EXTERNAL_GOOGLETEST=OFF \
		-DABSL_USE_GOOGLETEST_HEAD=OFF \
		-DABSL_RUN_TESTS=OFF

$(DEINSTALLSTEP):
	rm -rf $(INSTALLDIR)

$(CLEANSTEP):
	rm -rf $(BUILDDIR)
