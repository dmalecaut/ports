PROJECT=c-ares
PROJCMAKEDIR=c-ares
BUILDDIR=build
INSTALLROOTDIR=/usr/local/opt
INSTALLDIR=$(INSTALLROOTDIR)/$(PROJECT)
BUILDTYPE=Release
CMGENERATOR=Ninja

CC=clang

INSTALLSTEP=$(PROJECT)_install
BUILDSTEP=$(PROJECT)_build
CONFIGSTEP=$(PROJECT)_config
UPDATESTEP=$(PROJECT)_update
DEINSTALLSTEP=$(PROJECT)_deinstall
CLEANSTEP=$(PROJECT)_clean

all:

install: $(INSTALLSTEP)

build: $(BUILDSTEP)

config: $(CONFIGSTEP)

update: $(UPDATESTEP)

deinstall: $(DEINSTALLSTEP)

clean: $(CLEANSTEP)

$(INSTALLSTEP): $(BUILDSTEP)
	cmake --install $(BUILDDIR)

$(BUILDSTEP): $(CONFIGSTEP)
	cmake --build $(BUILDDIR)

$(CONFIGSTEP):
	cmake -Wno-dev -G$(CMGENERATOR) -B$(BUILDDIR) -S$(PROJCMAKEDIR) \
		-DCMAKE_INSTALL_PREFIX=$(INSTALLDIR) \
		-DCMAKE_BUILD_TYPE=$(BUILDTYPE) \
		-DCMAKE_C_COMPILER=$(CC) \
		-DCARES_STATIC=ON \
		-DCARES_SHARED=ON \
		-DCARES_INSTALL=ON \
		-DCARES_STATIC_PIC=ON \
		-DCARES_BUILD_TESTS=OFF \
		-DCARES_BUILD_CONTAINER_TESTS=OFF \
		-DCARES_BUILD_TOOLS=ON

$(UPDATESTEP):
	git submodule update --remote


$(DEINSTALLSTEP):
	rm -rf $(INSTALLDIR)

$(CLEANSTEP):
	rm -rf $(BUILDDIR)
