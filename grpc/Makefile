include ../config.mk

PROJECT := grpc
ROOTDIR := grpc
SRCDIR  := grpc

MODULES := \
	$(INSTALLROOTDIR)/abseil-cpp \
	$(INSTALLROOTDIR)/protobuf \
	$(INSTALLROOTDIR)/re2 \
	$(INSTALLROOTDIR)/c-ares \
	$(INSTALLROOTDIR)/openssl \
	$(INSTALLROOTDIR)/zlib
MODULES != echo $(MODULES) | sed -e 's/ /;/g'

INSTALLCMD := cmake --install $(BUILDDIR)
BUILDCMD   := cmake --build $(BUILDDIR)
CONFIGCMD  := \
	cmake -Wno-dev -G$(GENERATOR) -B$(BUILDDIR) -S$(SRCDIR) \
		-DCMAKE_PREFIX_PATH="$(MODULES)" \
		-DCMAKE_INSTALL_PREFIX=$(INSTALLDIR) \
		-DCMAKE_BUILD_TYPE=$(BUILDTYPE) \
		-DCMAKE_C_COMPILER=$(CC) \
		-DCMAKE_CXX_COMPILER=$(CXX) \
		-DCMAKE_CXX_FLAGS="$(CXXFLAGS)" \
		-DCMAKE_STATIC_LINKER_FLAGS="$(LDFLAGS)" \
		-DCMAKE_SHARED_LINKER_FLAGS="$(LDFLAGS)" \
		-DCMAKE_EXE_LINKER_FLAGS="$(LDFLAGS)" \
		-DBUILD_SHARED_LIBS=TRUE \
		-DgRPC_BUILD_TESTS=OFF \
		-DgRPC_BUILD_CODEGEN=ON \
		-DgRPC_BUILD_CSHARP_EXT=OFF \
		-DgRPC_BACKWARDS_COMPATIBILITY_MODE=OFF \
		-DgRPC_ABSL_PROVIDER=package \
		-DgRPC_PROTOBUF_PROVIDER=package \
		-DgRPC_RE2_PROVIDER=package \
		-DgRPC_CARES_PROVIDER=package \
		-DgRPC_SSL_PROVIDER=package \
		-DgRPC_ZLIB_PROVIDER=package

include ../build.mk
